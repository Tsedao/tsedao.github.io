<!doctype html><html lang=en-us>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Docker Installation Install docker engine and Nvidia-docker on related platforms.
Problem of seeing CUDA11 on docker while the host CUDA version in 11.
 One of the primary functions of nvidia-docker is to inject the all of NVIDIA driver libs from the host into the container so that the container will run properly with GPUs. One of these libraries is libcuda.so. This is one of the reasons you are seeing nvidia-smi report the driver version from your host."><title>Docker Tutorial</title>
<link rel=canonical href=https://tsedao.github.io/p/docker-tutorial/>
<link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="Docker Tutorial">
<meta property="og:description" content="Docker Installation Install docker engine and Nvidia-docker on related platforms.
Problem of seeing CUDA11 on docker while the host CUDA version in 11.
 One of the primary functions of nvidia-docker is to inject the all of NVIDIA driver libs from the host into the container so that the container will run properly with GPUs. One of these libraries is libcuda.so. This is one of the reasons you are seeing nvidia-smi report the driver version from your host.">
<meta property="og:url" content="https://tsedao.github.io/p/docker-tutorial/">
<meta property="og:site_name" content="漏斗蛋糕">
<meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="Docker"><meta property="article:published_time" content="2021-12-26T11:47:08+08:00"><meta property="article:modified_time" content="2021-12-26T11:47:08+08:00">
<meta name=twitter:title content="Docker Tutorial">
<meta name=twitter:description content="Docker Installation Install docker engine and Nvidia-docker on related platforms.
Problem of seeing CUDA11 on docker while the host CUDA version in 11.
 One of the primary functions of nvidia-docker is to inject the all of NVIDIA driver libs from the host into the container so that the container will run properly with GPUs. One of these libraries is libcuda.so. This is one of the reasons you are seeing nvidia-smi report the driver version from your host.">
</head>
<body class=article-page>
<script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script>
<div class="container main-container flex
on-phone--column extended">
<aside class="sidebar left-sidebar sticky">
<button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box>
<span class=hamburger-inner></span>
</span>
</button>
<header class=site-info>
<figure class=site-avatar>
<img src=/img/avatar_hu316606598dce80536938c95be6b25667_3076_300x0_resize_q75_box.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
<span class=emoji>🍥</span>
</figure>
<h1 class=site-name><a href=/>漏斗蛋糕</a></h1>
<h2 class=site-description>自从那伙人毁了我在达拉然的酒馆，我就开始了自由职业。</h2><ol class=social-menu>
<li>
<a href=https://github.com/Tsedao target=_blank title=GitHub><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg>
</a>
</li>
<li>
<a href=https://twitter.com target=_blank title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg>
</a>
</li>
</ol></header>
<ol class=menu id=main-menu>
<li>
<a href=/ target=_blank><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span>
</a>
</li>
<li>
<a href=/about/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span>
</a>
</li>
<li>
<a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span>
</a>
</li>
<li>
<a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span>
</a>
</li>
<li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span>
</li>
</ol>
</aside>
<main class="main full-width">
<article class=main-article>
<header class=article-header>
<div class=article-details>
<header class=article-category>
<a href=/categories/software/>
Software
</a>
</header>
<h2 class=article-title>
<a href=/p/docker-tutorial/>Docker Tutorial</a>
</h2>
<footer class=article-time>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Dec 26, 2021</time>
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>
2 minute read
</time>
</div>
</footer>
</div>
</header>
<section class=article-content>
<h1 id=docker-installation>Docker Installation</h1>
<p>Install <code>docker engine</code> and <code>Nvidia-docker</code> on related platforms.</p>
<p>Problem of seeing CUDA11 on docker while the host CUDA version in 11.</p>
<blockquote>
<p>One of the primary functions of <code>nvidia-docker</code> is to inject the all of NVIDIA driver libs from the host into the container so that the container will run properly with GPUs. One of these libraries is <code>libcuda.so</code>. This is one of the reasons you are seeing <code>nvidia-smi</code> report the driver version from your host.</p>
</blockquote>
<p>Different between nvidia docker image: <a class=link href=https://blog.csdn.net/qq_31511955/article/details/115112473 target=_blank rel=noopener>base/runtime/devel</a></p>
<h1 id=example-template-format-of-dockerfile>Example Template Format of Dockerfile</h1>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=k>FROM</span><span class=s> nvidia/cuda:10.2-cudnn7-runtime-ubuntu18.04</span><span class=err>
</span><span class=err></span><span class=k>ENV</span> <span class=nv>PATH</span><span class=o>=</span><span class=s2>&#34;/root/miniconda3/bin:</span><span class=si>${</span><span class=nv>PATH</span><span class=si>}</span><span class=s2>&#34;</span><span class=err>
</span><span class=err></span><span class=k>ARG</span> <span class=nv>PATH</span><span class=o>=</span><span class=s2>&#34;/root/miniconda3/bin:</span><span class=si>${</span><span class=nv>PATH</span><span class=si>}</span><span class=s2>&#34;</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=k>RUN</span> apt update <span class=se>\
</span><span class=se></span>    <span class=o>&amp;&amp;</span> apt install -y htop python3-dev wget<span class=err>
</span><span class=err>
</span><span class=err></span><span class=k>RUN</span> wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh <span class=se>\
</span><span class=se></span>    <span class=o>&amp;&amp;</span> mkdir root/.conda <span class=se>\
</span><span class=se></span>    <span class=o>&amp;&amp;</span> sh Miniconda3-latest-Linux-x86_64.sh -b <span class=se>\
</span><span class=se></span>    <span class=o>&amp;&amp;</span> rm -f Miniconda3-latest-Linux-x86_64.sh<span class=err>
</span><span class=err>
</span><span class=err></span><span class=k>RUN</span> conda create -y -n env_name <span class=nv>python</span><span class=o>=</span>3.7<span class=err>
</span><span class=err>
</span><span class=err></span><span class=k>COPY</span> . home/<span class=err>
</span><span class=err>
</span><span class=err></span><span class=k>RUN</span> /bin/bash -c <span class=s2>&#34;cd home/ \
</span><span class=s2>    &amp;&amp; source activate env_name \
</span><span class=s2>    &amp;&amp; pip install -i https://pypi.tuna.tsinghua.edu.cn/simple -r requirements.txt&#34;</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=k>WORKDIR</span><span class=s> home/</span><span class=err>
</span><span class=err></span><span class=k>CMD</span> <span class=p>[]</span><span class=err>
</span></code></pre></div><h1 id=build-your-customized-image-through-dockerfile>Build your customized image through Dockerfile</h1>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>$ docker build -t nameOfyouImage .
</code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>$ docker run -it nameOfyouImage /bin/bash <span class=se>\
</span><span class=se></span>           -v absolute path of your localhost:absolute path of your remotehost <span class=se>\
</span><span class=se></span>           -p <span class=o>[</span>porting<span class=o>]</span> <span class=se>\
</span><span class=se></span>           --rm <span class=o>[</span>run the container the remove it after <span class=nb>exit</span> it<span class=o>]</span>
           --gpus
</code></pre></div><p>Docker run contains docker create and run two commands, it first creates a container based on one image, then it runs /bin/bash on the container. One can use <code>exit</code> to stop the container or can push <code>Ctrl + P + Q</code> to detach container&rsquo;s terminal and keep the container running.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh>$ docker ps
</code></pre></div><p>Checking the running container, option <code>-a</code> can be used to check the exited containers.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh>$ docker start CONTAINERID
</code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh>$ docker attach CONTAINERID
$ docker <span class=nb>exec</span> -ti CONTAINERID  <span class=c1># exec abd attach both require the container is running</span>
</code></pre></div><p>Through ```docker ps `` , we could use the ID number of the container to restart it and attach to it based on the specified commends.</p>
<h1 id=saving-and-loading-the-docker-image>Saving and loading the Docker image</h1>
<p>Some of the servers are offline, some we may package the image we want and upload it to the remote server.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh>$ docker commit   <span class=c1># commit the change to the image</span>
</code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh>$ docker save myimage:latest <span class=p>|</span> gzip &gt; myimage_latest.tar.gz
</code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh>$ docker image load -i myimage_latest.tar.gz
</code></pre></div><h1 id=source>Source</h1>
<p><a class=link href="https://www.youtube.com/watch?v=0qG_0CPQhpg" target=_blank rel=noopener>https://www.youtube.com/watch?v=0qG_0CPQhpg</a></p>
</section>
<footer class=article-footer>
<section class=article-tags>
<a href=/tags/docker/>Docker</a>
</section>
<section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span>
</section>
</footer>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css integrity=sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js integrity=sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script>
</article>
<aside class=related-contents--wrapper>
<h2 class=section-title>Related contents</h2>
<div class=related-contents>
<div class="flex article-list--tile">
<article>
<a href=/p/c-learning-note/>
<div class=article-details>
<h2 class=article-title>C++ Learning Note</h2>
</div>
</a>
</article>
</div>
</div>
</aside>
<div class=disqus-container>
<div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//hugo-theme-stack.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</div>
<style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style>
<script>window.addEventListener('onColorSchemeChange',a=>{DISQUS&&DISQUS.reset({reload:!0})})</script>
<footer class=site-footer>
<section class=copyright>
&copy;
2021 漏斗蛋糕
</section>
<section class=powerby>
Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> <br>
Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.5.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a>
</section>
</footer>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous>
</main>
</div>
<script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script>
</body>
</html>